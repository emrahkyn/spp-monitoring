{"version":3,"sources":["../src/panel_config_migration.ts"],"names":["migrate_V0_V1","panel","_","has","xAxis","labelFormat","minBucketWidthToShowWeekends","showCrosshair","showWeekends","yAxis","data","cards","cardSpacing","cardVSpacing","cardHSpacing","tooltip","freezeOnClick","usingUrl","items","hasRealItems","urls","length","url","base_url","label","showItems","item","urlTemplate","toString","urlText","urlIcon","icon_fa","urlToLowerCase","forcelowercase","valueDateFormat","replace","valueVar","useExtraSeries","extraSeries","index","format","push","statusmap","migratePanelConfig","ConfigVersion"],"mappings":";;;;;;;AAEA,WAASA,aAAT,CAAuBC,KAAvB,EAAmC;AACjC;AACA,QAAIC,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,mBAAb,CAAJ,EAAuC;AACrC,aAAOA,KAAK,CAACG,KAAN,CAAYC,WAAnB;AACD;;AACD,QAAIH,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,oCAAb,CAAJ,EAAwD;AACtD,aAAOA,KAAK,CAACG,KAAN,CAAYE,4BAAnB;AACD;;AACD,QAAIJ,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,qBAAb,CAAJ,EAAyC;AACvC,aAAOA,KAAK,CAACG,KAAN,CAAYG,aAAnB;AACD;;AACD,QAAIL,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,oBAAb,CAAJ,EAAwC;AACtC,aAAOA,KAAK,CAACG,KAAN,CAAYI,YAAnB;AACD;;AACD,QAAIN,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,qBAAb,CAAJ,EAAyC;AACvC,aAAOA,KAAK,CAACQ,KAAN,CAAYF,aAAnB;AACD;;AACD,QAAIL,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,iBAAb,CAAJ,EAAqC;AACnC,aAAOA,KAAK,CAACS,IAAb;AACD,KAnBgC,CAqBjC;;;AACA,QAAIR,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,mBAAb,CAAJ,EAAuC;AACrC,UAAI,CAACC,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,oBAAb,CAAL,EAAyC;AACvC,YAAIA,KAAK,CAACU,KAAN,CAAYC,WAAhB,EAA6B;AAC3BX,UAAAA,KAAK,CAACU,KAAN,CAAYE,YAAZ,GAA2BZ,KAAK,CAACU,KAAN,CAAYC,WAAvC;AACAX,UAAAA,KAAK,CAACU,KAAN,CAAYG,YAAZ,GAA2Bb,KAAK,CAACU,KAAN,CAAYC,WAAvC;AACD;AACF;;AACD,aAAOX,KAAK,CAACU,KAAN,CAAYC,WAAnB;AACD,KA9BgC,CAgCjC;AACA;;;AACA,QAAIV,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,UAAb,CAAJ,EAA8B;AAC5B,UAAI,CAACC,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,uBAAb,CAAL,EAA4C;AAC1CA,QAAAA,KAAK,CAACc,OAAN,CAAcC,aAAd,GAA8Bf,KAAK,CAACgB,QAApC;AACD;;AACD,aAAOhB,KAAK,CAACgB,QAAb;AACD,KAvCgC,CAyCjC;;;AACA,QAAIf,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,MAAb,CAAJ,EAA0B;AACxB,UAAI,CAACC,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,eAAb,CAAL,EAAoC;AAClCA,QAAAA,KAAK,CAACc,OAAN,CAAcG,KAAd,GAAsB,EAAtB;AACA,YAAIC,YAAY,GAAG,IAAnB;;AACA,YAAIlB,KAAK,CAACmB,IAAN,CAAWC,MAAX,IAAqB,CAAzB,EAA4B;AAC1BF,UAAAA,YAAY,GAAG,KAAf;AACD;;AACD,YAAIlB,KAAK,CAACmB,IAAN,CAAWC,MAAX,IAAqB,CAAzB,EAA4B;AAC1B,cAAIC,GAAG,GAAGrB,KAAK,CAACmB,IAAN,CAAW,CAAX,CAAV;;AACA,cAAIE,GAAG,CAACC,QAAJ,KAAiB,EAAjB,IAAuBD,GAAG,CAACE,KAAJ,KAAc,EAAzC,EAA6C;AAC3CL,YAAAA,YAAY,GAAG,KAAf;AACD;AACF;;AACD,YAAIA,YAAJ,EAAkB;AAChBlB,UAAAA,KAAK,CAACc,OAAN,CAAcU,SAAd,GAA0B,IAA1B;AADgB;AAAA;AAAA;;AAAA;AAEhB,iCAAgBxB,KAAK,CAACmB,IAAtB,8HAA4B;AAAA,kBAAnBE,IAAmB;AAC1B,kBAAII,IAAI,GAAG;AACTC,gBAAAA,WAAW,EAAEzB,CAAC,CAAC0B,QAAF,CAAWN,IAAG,CAACC,QAAf,CADJ;AAETM,gBAAAA,OAAO,EAAE3B,CAAC,CAAC0B,QAAF,CAAWN,IAAG,CAACE,KAAf,CAFA;AAGTM,gBAAAA,OAAO,EAAE5B,CAAC,CAAC0B,QAAF,CAAWN,IAAG,CAACS,OAAf,CAHA;AAITC,gBAAAA,cAAc,EAAEV,IAAG,CAACW,cAJX;AAKTC,gBAAAA,eAAe,EAAE;AALR,eAAX,CAD0B,CAQ1B;;AACA,kBAAIR,IAAI,CAACC,WAAL,KAAqB,EAAzB,EAA6B;AAC3B;AACAD,gBAAAA,IAAI,CAACC,WAAL,GAAmBzB,CAAC,CAACiC,OAAF,CAAUb,IAAG,CAACC,QAAd,EAAwB,SAAxB,EAAmC,sBAAnC,CAAnB,CAF2B,CAG3B;;AACAG,gBAAAA,IAAI,CAACC,WAAL,GAAmBzB,CAAC,CAACiC,OAAF,CAAUT,IAAI,CAACC,WAAf,EAA4B,gBAA5B,EAA8C,cAA9C,CAAnB,CAJ2B,CAK3B;;AACA,oBAAIS,QAAQ,GAAG,SAAf;;AACA,oBAAId,IAAG,CAACe,cAAJ,KAAuB,IAA3B,EAAiC;AAC/B;AACA,sBAAIf,IAAG,CAACgB,WAAJ,CAAgBC,KAAhB,GAAwB,CAAC,CAA7B,EAAgC;AAC9BH,oBAAAA,QAAQ,IAAI,MAAMd,IAAG,CAACgB,WAAJ,CAAgBC,KAAlC;AACD;;AAED,sBAAIC,MAAM,GAAGtC,CAAC,CAAC0B,QAAF,CAAWN,IAAG,CAACgB,WAAJ,CAAgBE,MAA3B,CAAb;;AACA,sBAAIA,MAAM,KAAK,qBAAf,EAAsC;AACpCJ,oBAAAA,QAAQ,IAAI,OAAZ;AACAV,oBAAAA,IAAI,CAACQ,eAAL,GAAuBM,MAAvB;AACD;AACF;;AAEDd,gBAAAA,IAAI,CAACC,WAAL,GAAmBzB,CAAC,CAACiC,OAAF,CAAUT,IAAI,CAACC,WAAf,EAA4B,gBAA5B,cAAoDS,QAApD,OAAnB;AACD;;AACDnC,cAAAA,KAAK,CAACc,OAAN,CAAcG,KAAd,CAAoBuB,IAApB,CAAyBf,IAAzB;AACD;AAlCe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmCjB;AACF;;AACD,aAAOzB,KAAK,CAACmB,IAAb;AACD,KA7FgC,CA+FjC;;;AACAnB,IAAAA,KAAK,CAACyC,SAAN,GAAkB;AAChB,uBAAiB;AADD,KAAlB;AAGD;;AAGM,WAASC,kBAAT,CAA4B1C,KAA5B,EAAwC;AAC7C,QAAIC,CAAC,CAACC,GAAF,CAAMF,KAAN,EAAa,WAAb,CAAJ,EAA+B;AAC7B,UAAIA,KAAK,CAACyC,SAAN,CAAgBE,aAAhB,IAAiC,IAArC,EAA2C;AACzC;AACD;AACF,KAJD,MAIO;AACL5C,MAAAA,aAAa,CAACC,KAAD,CAAb;AACD;;AACD;AACD;;gCATe0C,kB;;;;AAxGTzC,MAAAA,C","sourcesContent":["import _ from 'lodash';\n\nfunction migrate_V0_V1(panel: any) {\n  // Remove unused fields.\n  if (_.has(panel, \"xAxis.labelFormat\")) {\n    delete panel.xAxis.labelFormat;\n  }\n  if (_.has(panel, \"xAxis.minBucketWidthToShowWeekends\")) {\n    delete panel.xAxis.minBucketWidthToShowWeekends;\n  }\n  if (_.has(panel, \"xAxis.showCrosshair\")) {\n    delete panel.xAxis.showCrosshair;\n  }\n  if (_.has(panel, \"xAxis.showWeekends\")) {\n    delete panel.xAxis.showWeekends;\n  }\n  if (_.has(panel, \"yAxis.showCrosshair\")) {\n    delete panel.yAxis.showCrosshair;\n  }\n  if (_.has(panel, \"data.unitFormat\")) {\n    delete panel.data;\n  }\n\n  // Migrate cardSpacing value. Seems rare (update from version 0.0.2).\n  if (_.has(panel, \"cards.cardSpacing\")) {\n    if (!_.has(panel, \"cards.cardVSpacing\")) {\n      if (panel.cards.cardSpacing) {\n        panel.cards.cardVSpacing = panel.cards.cardSpacing\n        panel.cards.cardHSpacing = panel.cards.cardSpacing\n      }\n    }\n    delete panel.cards.cardSpacing;\n  }\n\n  // Migrate initial config for urls in tooltip (pull/86).\n  // 'usingUrl' was used to show tooltip with urls on click or not.\n  if (_.has(panel, \"usingUrl\")) {\n    if (!_.has(panel, \"tooltip.freezeOnClick\")) {\n      panel.tooltip.freezeOnClick = panel.usingUrl;\n    }\n    delete panel.usingUrl;\n  }\n\n  // 'urls' array is now tooltip.items array. Also items are changed.\n  if (_.has(panel, \"urls\")) {\n    if (!_.has(panel, \"tooltip.items\")) {\n      panel.tooltip.items = [];\n      let hasRealItems = true;\n      if (panel.urls.length == 0) {\n        hasRealItems = false;\n      }\n      if (panel.urls.length == 1) {\n        let url = panel.urls[0];\n        if (url.base_url === '' && url.label === '') {\n          hasRealItems = false;\n        }\n      }\n      if (hasRealItems) {\n        panel.tooltip.showItems = true;\n        for (let url of panel.urls) {\n          let item = {\n            urlTemplate: _.toString(url.base_url),\n            urlText: _.toString(url.label),\n            urlIcon: _.toString(url.icon_fa),\n            urlToLowerCase: url.forcelowercase,\n            valueDateFormat: '',\n          }\n          // replace $vars with new ${__vars} if url template is not empty\n          if (item.urlTemplate !== \"\") {\n            // $time was a graph time with prepended &\n            item.urlTemplate = _.replace(url.base_url, /\\$time/g, \"&${__url_time_range}\");\n            // $series_label was a y axis label\n            item.urlTemplate = _.replace(item.urlTemplate, /\\$series_label/, \"${__y_label}\");\n            // $series_extra was a value from bucket. This value has format options and index.\n            let valueVar = \"__value\";\n            if (url.useExtraSeries === true) {\n              // index?\n              if (url.extraSeries.index > -1) {\n                valueVar += \"_\" + url.extraSeries.index;\n              }\n\n              let format = _.toString(url.extraSeries.format);\n              if (format === 'YYYY/MM/DD/HH_mm_ss') {\n                valueVar += '_date';\n                item.valueDateFormat = format;\n              }\n            }\n\n            item.urlTemplate = _.replace(item.urlTemplate, /\\$series_extra/, `\\${${valueVar}}`);\n          }\n          panel.tooltip.items.push(item);\n        }\n      }\n    }\n    delete panel.urls;\n  }\n\n  // create statusmap metadata\n  panel.statusmap = {\n    \"ConfigVersion\": \"v1\",\n  }\n}\n\n\nexport function migratePanelConfig(panel: any) {\n  if (_.has(panel, \"statusmap\")) {\n    if (panel.statusmap.ConfigVersion == \"v1\") {\n      return;\n    }\n  } else {\n    migrate_V0_V1(panel);\n  }\n  return;\n}\n\n"],"file":"panel_config_migration.js"}